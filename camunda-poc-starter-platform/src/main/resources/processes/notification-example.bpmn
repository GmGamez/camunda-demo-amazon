<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="Definitions_0c3ypra" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="3.4.1">
  <bpmn:message id="Message_0cbuddc" name="notification-received" />
  <bpmn:message id="Message_0iffw20" name="Message_3stsq98" />
  <bpmn:message id="Message_0afo52y" />
  <bpmn:collaboration id="Collaboration_1cp394l">
    <bpmn:participant id="Participant_1ymguhj" name="Notiication Process" processRef="notifications" />
  </bpmn:collaboration>
  <bpmn:process id="notifications" name="Notification Process" isExecutable="true" camunda:isStartableInTasklist="false">
    <bpmn:scriptTask id="Task_068zl4x" name="Create notification message" camunda:asyncBefore="true" scriptFormat="freemarker" camunda:resultVariable="message" camunda:resource="emailMessage.ftl">
      <bpmn:incoming>SequenceFlow_0hki304</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_0b9qm3s</bpmn:outgoing>
    </bpmn:scriptTask>
    <bpmn:serviceTask id="Task_0odqb6s" name="Send e-mail" camunda:asyncBefore="true" camunda:class="com.camunda.poc.starter.bpm.EmailService">
      <bpmn:extensionElements>
        <camunda:executionListener event="start">
          <camunda:script scriptFormat="javascript" resource="setEmailSubjectAndDestination.js" />
        </camunda:executionListener>
      </bpmn:extensionElements>
      <bpmn:incoming>SequenceFlow_0b9qm3s</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_1iuykva</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:endEvent id="EndEvent_0tikcl8" name="Email Disabled">
      <bpmn:incoming>SequenceFlow_1h8ioh2</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:exclusiveGateway id="ExclusiveGateway_0sg1p49">
      <bpmn:incoming>SequenceFlow_0b89o14</bpmn:incoming>
      <bpmn:incoming>SequenceFlow_0qru4we</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_0hki304</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:receiveTask id="Task_1j0bvai" name="Wait for more notifications" messageRef="Message_0cbuddc">
      <bpmn:extensionElements>
        <camunda:executionListener class="com.camunda.poc.starter.bpm.QueueNotificationsEventListener" event="start" />
      </bpmn:extensionElements>
      <bpmn:incoming>SequenceFlow_1pb4c8z</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_03ciavm</bpmn:outgoing>
    </bpmn:receiveTask>
    <bpmn:endEvent id="EndEvent_04lm2ox">
      <bpmn:incoming>SequenceFlow_1iuykva</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:exclusiveGateway id="ExclusiveGateway_0kcjj6w" name="Result?">
      <bpmn:incoming>SequenceFlow_1sbx42s</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_0b89o14</bpmn:outgoing>
      <bpmn:outgoing>SequenceFlow_1pb4c8z</bpmn:outgoing>
      <bpmn:outgoing>SequenceFlow_1h8ioh2</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:businessRuleTask id="Task_1dfk77l" name="Check Notifications" camunda:resultVariable="DMNresult" camunda:decisionRef="notifications-rules" camunda:mapDecisionResult="singleResult">
      <bpmn:extensionElements>
        <camunda:executionListener delegateExpression="#{resultDMN}" event="end" />
      </bpmn:extensionElements>
      <bpmn:incoming>SequenceFlow_0x8opsi</bpmn:incoming>
      <bpmn:incoming>SequenceFlow_03ciavm</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_1sbx42s</bpmn:outgoing>
    </bpmn:businessRuleTask>
    <bpmn:startEvent id="StartEvent_1" name="Notification Received">
      <bpmn:extensionElements>
        <camunda:executionListener class="com.camunda.poc.starter.bpm.CounterDelegate" event="end" />
      </bpmn:extensionElements>
      <bpmn:outgoing>SequenceFlow_0x8opsi</bpmn:outgoing>
      <bpmn:messageEventDefinition messageRef="Message_0cbuddc" />
    </bpmn:startEvent>
    <bpmn:boundaryEvent id="BoundaryEvent_0hpcdbm" attachedToRef="Task_1j0bvai">
      <bpmn:outgoing>SequenceFlow_0qru4we</bpmn:outgoing>
      <bpmn:timerEventDefinition id="TimerEventDefinition_12o089p">
        <bpmn:timeDuration xsi:type="bpmn:tFormalExpression">PT10M</bpmn:timeDuration>
      </bpmn:timerEventDefinition>
    </bpmn:boundaryEvent>
    <bpmn:sequenceFlow id="SequenceFlow_0x8opsi" sourceRef="StartEvent_1" targetRef="Task_1dfk77l" />
    <bpmn:sequenceFlow id="SequenceFlow_1sbx42s" sourceRef="Task_1dfk77l" targetRef="ExclusiveGateway_0kcjj6w" />
    <bpmn:sequenceFlow id="SequenceFlow_0b89o14" name="Enough Notifications OrÂ  All Issues Resolved For Case" sourceRef="ExclusiveGateway_0kcjj6w" targetRef="ExclusiveGateway_0sg1p49">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">#{result == "send"}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="SequenceFlow_1pb4c8z" name="More Notifications Needed" sourceRef="ExclusiveGateway_0kcjj6w" targetRef="Task_1j0bvai">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">#{result == "wait"}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="SequenceFlow_03ciavm" sourceRef="Task_1j0bvai" targetRef="Task_1dfk77l" />
    <bpmn:sequenceFlow id="SequenceFlow_0qru4we" sourceRef="BoundaryEvent_0hpcdbm" targetRef="ExclusiveGateway_0sg1p49" />
    <bpmn:sequenceFlow id="SequenceFlow_1h8ioh2" name="Email Disabled" sourceRef="ExclusiveGateway_0kcjj6w" targetRef="EndEvent_0tikcl8">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">#{result == 'cancel'}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="SequenceFlow_1iuykva" sourceRef="Task_0odqb6s" targetRef="EndEvent_04lm2ox" />
    <bpmn:sequenceFlow id="SequenceFlow_0hki304" sourceRef="ExclusiveGateway_0sg1p49" targetRef="Task_068zl4x" />
    <bpmn:sequenceFlow id="SequenceFlow_0b9qm3s" sourceRef="Task_068zl4x" targetRef="Task_0odqb6s" />
    <bpmn:textAnnotation id="TextAnnotation_0i40ye6">
      <bpmn:text>First one starts it</bpmn:text>
    </bpmn:textAnnotation>
    <bpmn:association id="Association_0noz9ff" sourceRef="StartEvent_1" targetRef="TextAnnotation_0i40ye6" />
  </bpmn:process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Collaboration_1cp394l">
      <bpmndi:BPMNShape id="Participant_1ymguhj_di" bpmnElement="Participant_1ymguhj" isHorizontal="true">
        <dc:Bounds x="156" y="85" width="926" height="486" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="StartEvent_0o0snv4_di" bpmnElement="StartEvent_1">
        <dc:Bounds x="215" y="297" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="206" y="340" width="55" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BusinessRuleTask_09w32bl_di" bpmnElement="Task_1dfk77l">
        <dc:Bounds x="301" y="275" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ExclusiveGateway_0kcjj6w_di" bpmnElement="ExclusiveGateway_0kcjj6w" isMarkerVisible="true">
        <dc:Bounds x="451" y="290" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="424" y="283" width="38" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_04lm2ox_di" bpmnElement="EndEvent_04lm2ox">
        <dc:Bounds x="1010" y="297" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ReceiveTask_186ogns_di" bpmnElement="Task_1j0bvai">
        <dc:Bounds x="583" y="428" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ExclusiveGateway_0sg1p49_di" bpmnElement="ExclusiveGateway_0sg1p49" isMarkerVisible="true">
        <dc:Bounds x="608" y="290" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_0tikcl8_di" bpmnElement="EndEvent_0tikcl8">
        <dc:Bounds x="458" y="122" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="439" y="105" width="74" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ServiceTask_0en6twi_di" bpmnElement="Task_0odqb6s">
        <dc:Bounds x="846" y="275" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ScriptTask_0o5jzo7_di" bpmnElement="Task_068zl4x">
        <dc:Bounds x="698" y="275" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="TextAnnotation_0i40ye6_di" bpmnElement="TextAnnotation_0i40ye6">
        <dc:Bounds x="251" y="217" width="100" height="40" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BoundaryEvent_1a898pa_di" bpmnElement="BoundaryEvent_0hpcdbm">
        <dc:Bounds x="615" y="410" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_0b9qm3s_di" bpmnElement="SequenceFlow_0b9qm3s">
        <di:waypoint x="798" y="315" />
        <di:waypoint x="846" y="315" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0hki304_di" bpmnElement="SequenceFlow_0hki304">
        <di:waypoint x="658" y="315" />
        <di:waypoint x="698" y="315" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1iuykva_di" bpmnElement="SequenceFlow_1iuykva">
        <di:waypoint x="946" y="315" />
        <di:waypoint x="1010" y="315" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1h8ioh2_di" bpmnElement="SequenceFlow_1h8ioh2">
        <di:waypoint x="476" y="290" />
        <di:waypoint x="476" y="158" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="485" y="179" width="74" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0qru4we_di" bpmnElement="SequenceFlow_0qru4we">
        <di:waypoint x="633" y="410" />
        <di:waypoint x="633" y="340" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_03ciavm_di" bpmnElement="SequenceFlow_03ciavm">
        <di:waypoint x="633" y="508" />
        <di:waypoint x="633" y="545" />
        <di:waypoint x="351" y="545" />
        <di:waypoint x="351" y="355" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1pb4c8z_di" bpmnElement="SequenceFlow_1pb4c8z">
        <di:waypoint x="476" y="340" />
        <di:waypoint x="476" y="468" />
        <di:waypoint x="583" y="468" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="484" y="364" width="61" height="40" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0b89o14_di" bpmnElement="SequenceFlow_0b89o14">
        <di:waypoint x="501" y="315" />
        <di:waypoint x="608" y="315" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="513" y="241" width="78" height="66" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1sbx42s_di" bpmnElement="SequenceFlow_1sbx42s">
        <di:waypoint x="401" y="315" />
        <di:waypoint x="451" y="315" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0x8opsi_di" bpmnElement="SequenceFlow_0x8opsi">
        <di:waypoint x="251" y="315" />
        <di:waypoint x="301" y="315" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Association_0noz9ff_di" bpmnElement="Association_0noz9ff">
        <di:waypoint x="245" y="302" />
        <di:waypoint x="284" y="257" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
